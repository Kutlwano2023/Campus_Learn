@using Microsoft.AspNetCore.Identity
@inject UserManager<Users> UserManager

@{
    ViewData["Title"] = "Dashboard Overview";
    Layout = "_Layout";

    // Get the current user and their full name
    var user = await UserManager.GetUserAsync(User);
    var fullName = user?.FullName ?? "User";
    var role = ViewBag.Role ?? "Student";
}

<link rel="stylesheet" href="~/css/dashboard.css" asp-append-version="true" />

<div class="dashboard-container">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-text">
                <h1 class="dashboard-title">Dashboard Overview</h1>
                <p class="dashboard-subtitle">Welcome back, @fullName! Here's your learning progress.</p>
            </div>
            <div class="header-badge">
                <div class="role-badge">
                    <i class="fas fa-user-circle me-2"></i>
                    Hello, @fullName! • <strong>@role</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="dashboard-content">
        <div class="dashboard-grid">
            <!-- Left Column - Main Content -->
            <div class="main-column">
                <!-- Upcoming Sessions Card -->
                <div class="section-card">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="title-icon bg-blue-100 text-blue-600">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div>
                                <h2>Upcoming Sessions</h2>
                                <p class="section-description">Your scheduled learning sessions</p>
                            </div>
                        </div>
                        <a asp-controller="Portal" asp-action="ScheduleSession" class="btn btn-outline">
                            <i class="fas fa-calendar-plus me-2"></i>View Calendar
                        </a>
                    </div>

                    <div class="sessions-list">
                        <!-- Session 1 -->
                        <div class="session-card">
                            <div class="session-avatar bg-primary">
                                AJ
                            </div>
                            <div class="session-details">
                                <div class="session-info">
                                    <h4>Alice Johnson</h4>
                                    <p class="session-meta">
                                        <i class="fas fa-book me-1"></i>JavaScript • 1 Hour
                                    </p>
                                    <div class="session-tags">
                                        <span class="tag tag-video">
                                            <i class="fas fa-video me-1"></i>Video Call
                                        </span>
                                    </div>
                                </div>
                                <div class="session-actions">
                                    <div class="session-time">
                                        <span class="time-badge badge-warning">Today, 2:00 PM</span>
                                    </div>
                                    <button class="btn btn-primary join-btn">
                                        <i class="fas fa-video me-1"></i>Join Session
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Session 2 -->
                        <div class="session-card">
                            <div class="session-avatar bg-success">
                                BS
                            </div>
                            <div class="session-details">
                                <div class="session-info">
                                    <h4>Bob Smith</h4>
                                    <p class="session-meta">
                                        <i class="fas fa-book me-1"></i>React • 1.5 hours
                                    </p>
                                    <div class="session-tags">
                                        <span class="tag tag-in-person">
                                            <i class="fas fa-user me-1"></i>In Person
                                        </span>
                                    </div>
                                </div>
                                <div class="session-actions">
                                    <div class="session-time">
                                        <span class="time-badge badge-info">Tomorrow, 10:00 AM</span>
                                    </div>
                                    <button class="btn btn-primary join-btn">
                                        <i class="fas fa-video me-1"></i>Join Session
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Session 3 -->
                        <div class="session-card">
                            <div class="session-avatar bg-info">
                                CD
                            </div>
                            <div class="session-details">
                                <div class="session-info">
                                    <h4>Carol Davis</h4>
                                    <p class="session-meta">
                                        <i class="fas fa-book me-1"></i>Python • 1 Hour
                                    </p>
                                    <div class="session-tags">
                                        <span class="tag tag-video">
                                            <i class="fas fa-video me-1"></i>Video Call
                                        </span>
                                    </div>
                                </div>
                                <div class="session-actions">
                                    <div class="session-time">
                                        <span class="time-badge badge-secondary">Wed, 3:00 PM</span>
                                    </div>
                                    <button class="btn btn-primary join-btn">
                                        <i class="fas fa-video me-1"></i>Join Session
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity Card -->
                <div class="section-card">
                    <div class="section-header">
                        <div class="section-title">
                            <div class="title-icon bg-purple-100 text-purple-600">
                                <i class="fas fa-history"></i>
                            </div>
                            <div>
                                <h2>Recent Activity</h2>
                                <p class="section-description">Latest interactions and updates</p>
                            </div>
                        </div>
                    </div>

                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon bg-success">
                                <i class="fas fa-share-alt"></i>
                            </div>
                            <div class="activity-content">
                                <h4>@(role == "Tutor" ? "New assignment submitted" : "Sarah shared notes on 'React Hooks'")</h4>
                                <p class="activity-time">2 hours ago</p>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon bg-info">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div class="activity-content">
                                <h4>@(role == "Tutor" ? "Student question in forum" : "Quiz results available")</h4>
                                <p class="activity-time">5 hours ago</p>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon bg-warning">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="activity-content">
                                <h4>@(role == "Tutor" ? "New student enrolled" : "Upcoming deadline reminder")</h4>
                                <p class="activity-time">1 day ago</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Sidebar -->
            <div class="sidebar-column">
                <!-- Today's Schedule Card -->
                <div class="section-card">
                    <div class="section-header">
                        <h2>Today's Schedule</h2>
                        <p class="section-description">Your agenda for today</p>
                    </div>

                    <div class="schedule-grid">
                        <div class="time-slot">
                            <div class="time-value">2:00 PM</div>
                            <div class="time-label">Session</div>
                        </div>
                        <div class="time-slot">
                            <div class="time-value">3:30 PM</div>
                            <div class="time-label">Session</div>
                        </div>
                        <div class="time-slot highlighted">
                            <div class="time-value">1:00 PM</div>
                            <div class="time-label">Study Group</div>
                        </div>
                        <div class="time-slot accent">
                            <div class="time-value">4:30 PM</div>
                            <div class="time-label">Office Hours</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Card -->
                <div class="section-card">
                    <div class="section-header">
                        <h2>Quick Actions</h2>
                        <p class="section-description">Frequently used features</p>
                    </div>

                    <div class="quick-actions">
                        <a asp-controller="Portal" asp-action="ScheduleSession" class="action-item">
                            <div class="action-icon bg-primary">
                                <i class="fas fa-calendar-plus"></i>
                            </div>
                            <div class="action-content">
                                <h4>Schedule Session</h4>
                                <p>Book a new tutoring session</p>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>

                        <a asp-controller="Portal" asp-action="Resources" class="action-item">
                            <div class="action-icon bg-success">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="action-content">
                                <h4>Learning Resources</h4>
                                <p>Access study materials</p>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>

                        <a href="#" id="openMessagesQuickAction" class="action-item">
                            <div class="action-icon bg-info">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="action-content">
                                <h4>Messages</h4>
                                <p>Check new messages</p>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>

                        <a asp-controller="Portal" asp-action="Assignments" class="action-item">
                            <div class="action-icon bg-warning">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="action-content">
                                <h4>Assignments</h4>
                                <p>View pending work</p>
                            </div>
                            <i class="fas fa-chevron-right action-arrow"></i>
                        </a>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon bg-primary">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">@(role == "Tutor" ? "8" : "5")</div>
                            <div class="stat-label">Active Courses</div>
                            <div class="stat-description">@(role == "Tutor" ? "Teaching" : "Enrolled") courses</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-success">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">85%</div>
                            <div class="stat-label">Avg. Progress</div>
                            <div class="stat-description">Overall performance</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Card -->
                <div class="section-card">
                    <div class="section-header">
                        <h2>Current Progress</h2>
                        <p class="section-description">Your active learning paths</p>
                    </div>

                    <div class="progress-list">
                        <div class="progress-item">
                            <div class="progress-info">
                                <strong>@(role == "Tutor" ? "Student Performance" : "React Fundamentals")</strong>
                                <span>75%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%"></div>
                            </div>
                        </div>

                        <div class="progress-item">
                            <div class="progress-info">
                                <strong>@(role == "Tutor" ? "Course Completion" : "JavaScript ES6+")</strong>
                                <span>90%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 90%"></div>
                            </div>
                        </div>

                        <div class="progress-item">
                            <div class="progress-info">
                                <strong>@(role == "Tutor" ? "Student Engagement" : "Database Design")</strong>
                                <span>60%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Join session button functionality
            const joinButtons = document.querySelectorAll('.join-btn');
            joinButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const sessionCard = this.closest('.session-card');
                    const tutorName = sessionCard.querySelector('h4').textContent;

                    // Show loading state
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Connecting...';
                    this.disabled = true;

                    // Simulate connection
                    setTimeout(() => {
                        showNotification(`Connecting to session with ${tutorName}...`, 'info');
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }, 2000);
                });
            });

            // Quick action for messages
            const openMessagesQuickAction = document.getElementById('openMessagesQuickAction');
            if (openMessagesQuickAction) {
                openMessagesQuickAction.addEventListener('click', function(e) {
                    e.preventDefault();
                    const messageWidgetBtn = document.getElementById('messageWidgetBtn');
                    if (messageWidgetBtn) {
                        messageWidgetBtn.click();
                        showNotification('Opening messages...', 'info');
                    }
                });
            }

            // Initialize progress bar animations
            animateProgressBars();
        });

        function animateProgressBars() {
            const progressBars = document.querySelectorAll('.progress-fill');

            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';

                setTimeout(() => {
                    bar.style.transition = 'width 1s ease-in-out';
                    bar.style.width = width;
                }, 100);
            });
        }

        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existing = document.querySelectorAll('.dashboard-notification');
            existing.forEach(notification => notification.remove());

            const notification = document.createElement('div');
            notification.className = `dashboard-notification notification-${type}`;

            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };

            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas ${icons[type]} me-2"></i>
                    <span>${message}</span>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;

            // Add styles
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${getNotificationColor(type)};
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                font-size: 14px;
                max-width: 300px;
                transform: translateX(100%);
                opacity: 0;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 1rem;
            `;

            document.body.appendChild(notification);

            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 10);

            // Auto remove
            setTimeout(() => {
                hideNotification(notification);
            }, 4000);
        }

        function getNotificationColor(type) {
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#3b82f6'
            };
            return colors[type] || colors.info;
        }

        function hideNotification(notification) {
            notification.style.transform = 'translateX(100%)';
            notification.style.opacity = '0';
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 300);
        }
    </script>
}